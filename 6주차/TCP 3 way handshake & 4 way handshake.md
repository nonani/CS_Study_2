# π“΅ TCP 3-Way Handshake

TCPλ” λ°μ΄ν„°λ¥Ό μ „μ†΅ν•κΈ° μ „μ— λ°λ“μ‹ **μ‹ λΆ°ν•  μ μλ” μ—°κ²°**μ„ λ¨Όμ € μ„¤μ •ν•©λ‹λ‹¤. μ΄ κ³Όμ •μ„ **3-Way Handshake**λΌκ³  ν•λ©°, **3λ²μ λ©”μ‹μ§€ κµν™**μΌλ΅ μ—°κ²°μ΄ μ„±λ¦½λ©λ‹λ‹¤.

https://youtube.com/shorts/N-j-FZ5c9n0?si=bokNIONf6pPZOa0B

https://youtube.com/shorts/R6WN4_bBB1Q?si=UJ0G0ufK3i38fjs-

---

## β… μ—°κ²° μ„¤μ • λ‹¨κ³„
![img.png](assets/img.png)
### π§© STEP 1: ν΄λΌμ΄μ–ΈνΈ β†’ μ„λ²„ (SYN)

- ν΄λΌμ΄μ–ΈνΈκ°€ μ„λ²„μ—κ² **μ—°κ²° μ”μ²­**μ„ λ³΄λƒ…λ‹λ‹¤.
- λ³΄λ‚Έ ν¨ν‚·μ—λ” λ‹¤μ μ •λ³΄κ°€ λ‹΄κΉλ‹λ‹¤:
  - `SYN` ν”λκ·Έ = 1
  - ν΄λΌμ΄μ–ΈνΈμ **μ΄κΈ° μ‹ν€€μ¤ λ²νΈ(ISN)**

> π“ μμ‹: μ „ν™” ν†µν™”μ—μ„ "μ—¬λ³΄μ„Έμ”?"λΌκ³  λ¨Όμ € κ±°λ” κ²ƒκ³Ό κ°™μµλ‹λ‹¤.

---

### π§© STEP 2: μ„λ²„ β†’ ν΄λΌμ΄μ–ΈνΈ (SYN + ACK)

- μ„λ²„λ” SYNμ„ λ°›κ³  μ‘λ‹µν•©λ‹λ‹¤:
  - `SYN` ν”λκ·Έ = 1
  - `ACK` ν”λκ·Έ = 1
  - μ„λ²„μ ISN + ν΄λΌμ΄μ–ΈνΈμ ISNμ— λ€ν• ν™•μΈ μ‘λ‹µ

> π“ μμ‹: μ „ν™” μƒλ€κ°€ "μ—¬λ³΄μ„Έμ”? λ„κµ¬λ„κµ¬μ…λ‹λ‹¤"λΌκ³  μ‘λ‹µν•λ” κ²ƒκ³Ό κ°™μµλ‹λ‹¤.

---

### π§© STEP 3: ν΄λΌμ΄μ–ΈνΈ β†’ μ„λ²„ (ACK)

- ν΄λΌμ΄μ–ΈνΈλ” μ„λ²„μ μ‘λ‹µ(SYN+ACK)μ„ ν™•μΈν•κ³  **λ§μ§€λ§‰μΌλ΅ ACK μ‘λ‹µ**μ„ λ³΄λƒ…λ‹λ‹¤:
  - `ACK` ν”λκ·Έ = 1
  - μ„λ²„ ISNμ— λ€ν• μ‘λ‹µ λ²νΈ

> π“ μμ‹: "λ„¤, μ—°κ²°λμµλ‹λ‹¤!"λΌκ³  λ§μ§€λ§‰ ν™•μΈ μΈμ‚¬λ¥Ό ν•λ” κ²ƒκ³Ό κ°™μµλ‹λ‹¤.

---

## β οΈ μμ™Έ μƒν™© & TCPμ λ€μ‘

### β— μμ™Έ 1: ν΄λΌμ΄μ–ΈνΈμ ACKκ°€ μ μ‹¤λ κ²½μ°

- μ„λ²„λ” `SYN_RCVD` μƒνƒμ—μ„ ν΄λΌμ΄μ–ΈνΈμ ACKλ¥Ό κΈ°λ‹¤λ¦Ό
- μΌμ • μ‹κ°„ λ‚΄μ— ACKκ°€ λ„μ°©ν•μ§€ μ•μΌλ©΄ **νƒ€μ„μ•„μ›ƒ ν›„ μ—°κ²° μΆ…λ£**

---

### β— μμ™Έ 2: μ„λ²„μ SYN+ACKκ°€ μ μ‹¤λ κ²½μ°

- ν΄λΌμ΄μ–ΈνΈλ” μ‘λ‹µμ„ λ» λ°›μΌλ©΄ μΌμ • μ‹κ°„ ν›„ **SYNμ„ μ¬μ „μ†΅**
- TCPλ” κΈ°λ³Έμ μΌλ΅ μ¬μ „μ†΅ νμμ™€ κ°„κ²©μ„ μ„¤μ •ν•μ—¬ **μ¬μ‹λ„**

---

### β— μμ™Έ 3: μ¤λλ SYNμ΄ λ’¤λ¦κ² μ„λ²„μ— λ„μ°©ν• κ²½μ°

- ν΄λΌμ΄μ–ΈνΈλ” μ΄λ―Έ μ—°κ²° μ”μ²­μ„ μ·¨μ†ν–λ”λ°,
- μ„λ²„κ°€ μ‘λ‹µμ„ λ³΄λ‚΄λ©΄ ν΄λΌμ΄μ–ΈνΈλ” μ΄λ¥Ό **μ• μ μ—†μ** μƒνƒλ΅ μΈμ‹
- ν΄λΌμ΄μ–ΈνΈλ” **RST(Reset)** ν¨ν‚·μ„ λ³΄λ‚΄ μ„λ²„μ—κ² "μ΄κ±΄ μλ»λ μ—°κ²°"μ΄λΌκ³  μ•λ¦Ό

---

## β… μ •λ¦¬ μ”μ•½

| λ‹¨κ³„ | μ£Όμ²΄ | λ‚΄μ© | ν”λκ·Έ |
|------|------|------|--------|
| 1 | ν΄λΌμ΄μ–ΈνΈ β†’ μ„λ²„ | μ—°κ²° μ”μ²­ | SYN |
| 2 | μ„λ²„ β†’ ν΄λΌμ΄μ–ΈνΈ | μ”μ²­ μλ½ + μ‘λ‹µ | SYN + ACK |
| 3 | ν΄λΌμ΄μ–ΈνΈ β†’ μ„λ²„ | μµμΆ… ν™•μΈ | ACK |

> π’΅ λ¨λ“  λ‹¨κ³„κ°€ μ™„λ£λλ©΄ μ–‘μ½μ€ `ESTABLISHED` μƒνƒλ΅ μ§„μ…ν•λ©°, λ°μ΄ν„° ν†µμ‹ μ„ μ‹μ‘ν•  μ μμµλ‹λ‹¤.

 ## β… 2. TCP 4-Way Handshake - μ—°κ²° μΆ…λ£

TCPλ” μ—°κ²°μ„ λμ„ λ•λ„ **μ •ν™•ν•κ³  μμ°¨μ μΈ μΆ…λ£ μ μ°¨**λ¥Ό λ”°λ¦…λ‹λ‹¤.  
λ°”λ΅ μ΄ κ³Όμ •μ„ **4-Way Handshake**λΌκ³  λ¶€λ¥΄λ©°,  
**μ–‘λ°©ν–¥ ν†µμ‹ μ΄λ―€λ΅ κ°κ°μ λ°©ν–¥μ„ λ”°λ΅ λ‹«μ•„μ•Ό ν•κΈ° λ•λ¬Έμ— 4λ‹¨κ³„κ°€ ν•„μ”**ν•©λ‹λ‹¤.

---
![img_1.png](assets/img_1.png)

### π“ μ—°κ²° μΆ…λ£ λ‹¨κ³„

#### π§© STEP 1: ν΄λΌμ΄μ–ΈνΈ β†’ μ„λ²„ (FIN)

- ν΄λΌμ΄μ–ΈνΈκ°€ λ¨Όμ € "μ΄μ  λ³΄λ‚Ό λ°μ΄ν„°κ°€ μ—†μ–΄μ”"λΌκ³  μ•λ¦Ό
- `FIN` ν”λκ·Έκ°€ μ„¤μ •λ ν¨ν‚·μ„ μ „μ†΅
- ν΄λΌμ΄μ–ΈνΈλ” `FIN_WAIT_1` μƒνƒκ°€ λ¨

---

#### π§© STEP 2: μ„λ²„ β†’ ν΄λΌμ΄μ–ΈνΈ (ACK)

- μ„λ²„κ°€ ν΄λΌμ΄μ–ΈνΈμ FINμ„ λ°›κ³  ν™•μΈ μ‘λ‹µ
- `ACK` ν”λκ·Έκ°€ μ„¤μ •λ ν¨ν‚·μ„ λ³΄λƒ„
- μ„λ²„λ” `CLOSE_WAIT` μƒνƒκ°€ λ¨ (μ•„μ§ λ°μ΄ν„° μ „μ†΅ κ°€λ¥)
- ν΄λΌμ΄μ–ΈνΈλ” `FIN_WAIT_2` μƒνƒλ΅ μ „ν™

---

#### π§© STEP 3: μ„λ²„ β†’ ν΄λΌμ΄μ–ΈνΈ (FIN)

- μ„λ²„λ„ "μ΄μ  μ €λ„ λ‹¤ λ³΄λƒμ–΄μ”"λΌκ³  μΆ…λ£ μ”μ²­
- `FIN` ν”λκ·Έκ°€ μ„¤μ •λ ν¨ν‚· μ „μ†΅
- μ„λ²„λ” `LAST_ACK` μƒνƒκ°€ λ¨

---

#### π§© STEP 4: ν΄λΌμ΄μ–ΈνΈ β†’ μ„λ²„ (ACK)

- ν΄λΌμ΄μ–ΈνΈκ°€ μ„λ²„μ FINμ— λ€ν•΄ ν™•μΈ μ‘λ‹µ
- `ACK` ν”λκ·Έκ°€ μ„¤μ •λ ν¨ν‚·μ„ μ „μ†΅
- ν΄λΌμ΄μ–ΈνΈλ” `TIME_WAIT` μƒνƒμ— λ“¤μ–΄κ°€ μΌμ • μ‹κ°„ λ€κΈ° ν›„ `CLOSED`
- μ„λ²„λ” ACKλ¥Ό λ°›κ³  μ¦‰μ‹ `CLOSED` μƒνƒλ΅ μ „ν™

---

### β οΈ μμ™Έ μƒν™© & TCPμ λ€μ‘

#### β— μμ™Έ 1: μ„λ²„μ FINμ΄ μ μ‹¤λ¨

- μ„λ²„λ” ν΄λΌμ΄μ–ΈνΈλ΅λ¶€ν„° ACKλ¥Ό λ» λ°›μ β†’ FINμ„ μ¬μ „μ†΅
- ν΄λΌμ΄μ–ΈνΈλ” μ—¬μ „ν `TIME_WAIT` μƒνƒμ΄λ―€λ΅ FINμ„ μμ‹  κ°€λ¥ β†’ λ‹¤μ‹ ACK μ „μ†΅

---

#### β— μμ™Έ 2: ν΄λΌμ΄μ–ΈνΈμ λ§μ§€λ§‰ ACKκ°€ μ μ‹¤λ¨

- μ„λ²„λ” ACKλ¥Ό λ» λ°›μΌλ©΄ FINμ„ μ¬μ „μ†΅
- ν΄λΌμ΄μ–ΈνΈλ” `TIME_WAIT` μƒνƒμ—μ„ ν•΄λ‹Ή FINμ„ λ‹¤μ‹ λ°›κ³  ACKλ¥Ό μ¬μ „μ†΅ν•¨
- **κ·Έλμ„ TIME_WAITμ€ κΌ­ ν•„μ”ν• μƒνƒ**

---

#### β— μμ™Έ 3: ν΄λΌμ΄μ–ΈνΈκ°€ FIN λ³΄λ‚΄μλ§μ μ†μΌ“ μΆ…λ£

- μ„λ²„κ°€ FINμ„ μ¬μ „μ†΅ν•΄λ„ ν΄λΌμ΄μ–ΈνΈλ” μ‘λ‹µν•  μ μ—†μ
- ν΄λΌμ΄μ–ΈνΈκ°€ μ†μΌ“μ„ λ‹«μ•„λ²„λ ΈκΈ° λ•λ¬Έμ— FINμ— λ€ν•΄ RSTλ΅ μ‘λ‹µν•κ±°λ‚ λ¬΄μ‹
- μ„λ²„λ” μ—°κ²° μƒνƒλ¥Ό μ •ν™•ν μ• μ μ—†μ–΄ **μμ› λ‚­λΉ„, λΉ„μ •μƒ μƒνƒ λ°μƒ**

---

### β… μ •λ¦¬ μ”μ•½

| λ‹¨κ³„ | μ£Όμ²΄ | λ‚΄μ© | ν”λκ·Έ | μƒνƒ λ³€ν™” |
|------|------|------|--------|------------|
| 1 | ν΄λΌμ΄μ–ΈνΈ β†’ μ„λ²„ | μ—°κ²° μΆ…λ£ μ”μ²­ | FIN | `FIN_WAIT_1` |
| 2 | μ„λ²„ β†’ ν΄λΌμ΄μ–ΈνΈ | μΆ…λ£ μλ½ | ACK | `CLOSE_WAIT`, `FIN_WAIT_2` |
| 3 | μ„λ²„ β†’ ν΄λΌμ΄μ–ΈνΈ | μ„λ²„λ„ μΆ…λ£ μ”μ²­ | FIN | `LAST_ACK` |
| 4 | ν΄λΌμ΄μ–ΈνΈ β†’ μ„λ²„ | μµμΆ… ν™•μΈ | ACK | `TIME_WAIT β†’ CLOSED`<br>(μ„λ²„λ” λ°”λ΅ CLOSED) |

> π’΅ **TIME_WAIT μƒνƒλ” λ§μ§€λ§‰ ACK μ†μ‹¤ μƒν™©μ— λ€λΉ„ν•κΈ° μ„ν• λ³΄νΈ νƒ€μ΄λ¨Έμ…λ‹λ‹¤.**

